angular.module("comments",["ngRoute","ui.bootstrap","ngSanitize"]).config(["$routeProvider","$locationProvider",function(t,e){t.when("/",{templateUrl:"comments/comments.view.html",controller:"commentsCtrl",controllerAs:"vm"}).when("/comments/:idComment",{templateUrl:"comments/commentViewing/commentView.view.html",controller:"commentsViewCtrl",controllerAs:"vm"}).when("/registration",{templateUrl:"/auth/registration/registration.view.html",controller:"registrationCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/404",{templateUrl:"error/404.template.html"}).otherwise({redirectTo:"/404"}),e.html5Mode(!0),e.hashPrefix("")}]),function(){function t(n,o){return{comments:function(){return n.get("/api/comments")},commentById:function(t){return n.get("/api/comments/"+t)},editCommentById:function(t,e){return n.post("/api/comments/edit/"+t,e,{headers:{Authorization:"Bearer "+o.returnToken()}})},deleteById:function(t){o.currUser();return n.delete("/api/comments/"+t,{headers:{Authorization:"Bearer "+o.returnToken()}})},newComment:function(t){return n.post("/api/comments/new",t,{headers:{Authorization:"Bearer "+o.returnToken()}})},getCommentsPage:function(t){return n.get("/api/comments",{params:t})},getCommentsCount:function(t){return n.get("/api/comments-count",{})}}}t.$inject=["$http","authentication"],angular.module("comments").service("commentsData",t)}(),function(){function t(e,n){var o=function(t){return decodeURIComponent(Array.prototype.map.call(e.atob(t),function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""))},r=function(t){e.localStorage["comments-token"]=t},a=function(){return e.localStorage["comments-token"]},i=function(){var t=a();return!!t&&JSON.parse(o(t.split(".")[1])).validityDate>Date.now()/1e3};return{storeToken:r,returnToken:a,registration:function(t){return console.log("auth",t),n.post("/api/registration",t).then(function(t){r(t.data.token)})},login:function(t){return n.post("/api/login",t).then(function(t){r(t.data.token)})},logout:function(){e.localStorage.removeItem("comments-token")},logedin:i,currUser:function(){if(i()){var t=a(),e=JSON.parse(o(t.split(".")[1]));return{mail:e.mail,name:e.name}}},isAdmin:function(){if(i()){var t=a();return JSON.parse(o(t.split(".")[1])).admin}},getDataFromToken:function(t){return JSON.parse(o(t.split(".")[1]))}}}t.$inject=["$window","$http"],angular.module("comments").service("authentication",t)}(),function(){function t(e,t){var n=this;n.loginData={mail:"",pass:""},n.firstToDisplay=e.search().page||"/",n.sendContent=function(){if(n.error="",!n.loginData.mail||!n.loginData.pass)return!(n.error="All data required.");n.login()},n.login=function(){n.error="",console.log(n.loginData),t.login(n.loginData).then(function(t){e.search("page",null),e.path(n.firstToDisplay)},function(t){n.error=t.data})}}t.$inject=["$location","authentication"],angular.module("comments").controller("loginCtrl",t)}(),function(){function t(e,t){var n=this;n.registerData={name:"",mail:"",pass:""},n.firstToDisplay=e.search().page||"/",n.sendContent=function(){if(n.error="",!(n.registerData.name&&n.registerData.mail&&n.registerData.pass))return!(n.error="Enter all the data!");n.register()},n.register=function(){n.error="",t.registration(n.registerData).then(function(t){e.search("login",null),e.path(n.firstToDisplay)},function(t){n.error=t.data})}}t.$inject=["$location","authentication"],angular.module("comments").controller("registrationCtrl",t)}(),angular.module("comments").filter("startFrom",function(){return function(t,e){return e=+e,t.slice(e)}}),function(){function t(t,e,n,o,r){var a=this;a.title="Comments",a.msg="Searching comments...",a.logedin=o.logedin(),a.user=o.currUser(),a.newComment=function(){a.newcomment.pic="",a.newcomment.name=a.user.name,a.newcomment.username=a.user.mail,t.newComment(a.newcomment).then(function(t){a.msg=0<t.data.length?"":"No comments.",a.data.comments.push(t.data),a.newcomment.name="",a.newcomment.comment="",console.log(a.data)},function(t){a.msg="Error while fetching comments.",console.log(t.e)})},n.redirectTo=function(t){e.url("/comments/"+t._id)},a.currentPage=0,a.pageSize=10,a.q="",a.dataSize=0,a.data={},a.data.comments=[],a.data.count={},a.data.cached=[],t.getCommentsCount().then(function(t){a.data.count=t.data},function(t){a.msg="Error while fetching comments count.",console.log(t.e)}),a.getData=function(){return r("filter")(a.data.comments,a.q)},a.getDataLength=function(){return a.data.count.size},a.numberOfPages=function(){return a.data.count.pages},a.next=function(){a.currentPage=a.currentPage+1,a.data.comments=a.data.cached.slice(-1)[0],a.currentPage+1<a.numberOfPages()?t.getCommentsPage({page:a.currentPage-1,pagesNo:3,pageSize:a.pageSize}).then(function(t){a.data.cached=t.data},function(t){console.log(t.e)}):a.data.cached=a.data.cached.slice(1,3)},a.previous=function(){a.currentPage=a.currentPage-1,a.data.comments=a.data.comments=a.data.cached[0],1<a.currentPage-1?t.getCommentsPage({page:a.currentPage-1,pagesNo:3,pageSize:a.pageSize}).then(function(t){a.data.cached=t.data},function(t){a.msg="Error while fetching comments.",console.log(t.e)}):a.data.cached=a.data.cached.slice(0,2)},n.redirectTo=function(t){e.url("/comments/"+t._id)},a.data.comments.length||t.getCommentsPage({page:a.currentPage,pageSize:a.pageSize,pageNo:3}).then(function(t){a.msg=0<t.data.length?"":"No comments.",a.data.cached=t.data.slice(0,2),a.data.comments=t.data[0]},function(t){a.msg="Error while fetching comments.",console.log(t.e)})}t.$inject=["commentsData","$location","$scope","authentication","$filter"],angular.module("comments").controller("commentsCtrl",t)}(),function(){function t(t,e,n,o){var r=this;r.idComment=t.idComment,r.logedin=o.logedin(),r.canEdit=function(t){return!(!r.logedin||!t)&&o.getDataFromToken(o.returnToken())._id==t._creator},e.commentById(r.idComment).then(function(t){r.comment=t.data,r.general={title:r.comment.name}},function(t){console.log(t)}),r.editComm=function(t,e){n.open({templateUrl:"/comments/commentEdit/commentEdit.view.html",controller:"commentEdit",controllerAs:"vm",resolve:{commentDetails:function(){return{comment:e}}}}).result.then(function(t){void 0!==t&&(r.comment=t)},function(t){console.log("Error im comment View",t)})}}t.$inject=["$routeParams","commentsData","$uibModal","authentication"],angular.module("comments").controller("commentsViewCtrl",t)}(),function(){function t(e,t,n){var o=this;o.commentDetails=t,o.modalWindow={onclose:function(){e.close()},onsubmit:function(t){e.close(t)}},o.sendData=function(){return o.error="",o.editData.commentContent?(o.editComment(t.comment._id,o.editData.commentContent),!1):!(o.error="Input required!")},o.editComment=function(t,e){n.editCommentById(t,{comment:e}).then(function(t){o.modalWindow.onsubmit(t.data)},function(t){o.error="Error!"})}}t.$inject=["$uibModalInstance","commentDetails","commentsData"],angular.module("comments").controller("commentEdit",t)}(),function(){function t(t,n,e,o,r){var a=this;a.logedin=n.logedin(),a.landing="/"!=o.path(),a.user=n.currUser(),a.user&&(a.user.username=a.user.mail),a.canDelete=function(t){if(!a.logedin||!t)return!1;var e=n.getDataFromToken(n.returnToken());return e.admin||e._id==t._creator},a.deleteById=function(t){e.deleteById(t,a.user).then(function(t){o.path("/")},function(t){a.error="Error!"})}}t.$inject=["$scope","authentication","commentsData","$location","$route"],angular.module("comments").controller("commentDirCtrl",t)}(),function(){var t=function(t){return{restrict:"EA",scope:{commentdirective:"=onecomment",onclick:"&onclickf"},templateUrl:"/all/directives/comment/comment.view.html",controller:"commentDirCtrl",controllerAs:"commdirvm"}};t.$inject=["$uibModal"],angular.module("comments").directive("comment",t)}(),angular.module("comments").directive("footos",function(){return{restrict:"EA",templateUrl:"/all/directives/footer/footer.template.html"}}),function(){function t(t,e,n){this.currLocation=t.path(),this.logedin=e.logedin(),this.currUser=e.currUser(),this.logout=function(){e.logout(),t.path("/"),n.reload()}}t.$inject=["$location","authentication","$route"],angular.module("comments").controller("navigaCtrl",t)}(),angular.module("comments").directive("naviga",function(){return{restrict:"EA",templateUrl:"/all/directives/nav/nav.template.html",controller:"navigaCtrl",controllerAs:"navigavm"}});
