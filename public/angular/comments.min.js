angular.module("comments",["ngRoute","ui.bootstrap","ngSanitize"]).config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{templateUrl:"comments/comments.view.html",controller:"commentsCtrl",controllerAs:"vm"}).when("/comments/:idComment",{templateUrl:"comments/commentViewing/commentView.view.html",controller:"commentsViewCtrl",controllerAs:"vm"}).when("/registration",{templateUrl:"/auth/registration/registration.view.html",controller:"registrationCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/404",{templateUrl:"error/404.template.html"}).otherwise({redirectTo:"/404"}),t.html5Mode(!0),t.hashPrefix("")}]),function(){function e(n,a){return{comments:function(){return n.get("/api/comments")},commentById:function(e){return n.get("/api/comments/"+e)},editCommentById:function(e,t){return n.post("/api/comments/edit/"+e,t,{headers:{Authorization:"Bearer "+a.returnToken()}})},deleteById:function(e){a.currUser();return n.delete("/api/comments/"+e,{headers:{Authorization:"Bearer "+a.returnToken()}})},newComment:function(e){return n.post("/api/comments/new",e,{headers:{Authorization:"Bearer "+a.returnToken()}})},getCommentsPage:function(e){return n.get("/api/comments",{params:e})},getCommentsCount:function(e){return n.get("/api/comments-count",{})},commentByUsername:function(e){return n.get("/api/search/comments",{params:{name:e}})}}}e.$inject=["$http","authentication"],angular.module("comments").service("commentsData",e)}(),function(){function e(t,n){var a=function(e){return decodeURIComponent(Array.prototype.map.call(t.atob(e),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))},r=function(e){t.localStorage["comments-token"]=e},o=function(){return t.localStorage["comments-token"]},c=function(){var e=o();return!!e&&JSON.parse(a(e.split(".")[1])).validityDate>Date.now()/1e3};return{storeToken:r,returnToken:o,registration:function(e){return console.log("auth",e),n.post("/api/registration",e).then(function(e){r(e.data.token)})},login:function(e){return n.post("/api/login",e).then(function(e){r(e.data.token)})},logout:function(){t.localStorage.removeItem("comments-token")},logedin:c,currUser:function(){if(c()){var e=o(),t=JSON.parse(a(e.split(".")[1]));return{mail:t.mail,name:t.name}}},isAdmin:function(){if(c()){var e=o();return JSON.parse(a(e.split(".")[1])).admin}},getDataFromToken:function(e){return JSON.parse(a(e.split(".")[1]))}}}e.$inject=["$window","$http"],angular.module("comments").service("authentication",e)}(),function(){function e(t,e){var n=this;n.loginData={mail:"",pass:""},n.firstToDisplay=t.search().page||"/",n.sendContent=function(){if(n.error="",!n.loginData.mail||!n.loginData.pass)return!(n.error="All data required.");n.login()},n.login=function(){n.error="",console.log(n.loginData),e.login(n.loginData).then(function(e){t.search("page",null),t.path(n.firstToDisplay)},function(e){n.error=e.data})}}e.$inject=["$location","authentication"],angular.module("comments").controller("loginCtrl",e)}(),function(){function e(t,e){var n=this;n.registerData={name:"",mail:"",pass:""},n.firstToDisplay=t.search().page||"/",n.sendContent=function(){if(n.error="",!(n.registerData.name&&n.registerData.mail&&n.registerData.pass))return!(n.error="Enter all the data!");n.register()},n.register=function(){n.error="",e.registration(n.registerData).then(function(e){t.search("login",null),t.path(n.firstToDisplay)},function(e){n.error=e.data})}}e.$inject=["$location","authentication"],angular.module("comments").controller("registrationCtrl",e)}(),angular.module("comments").filter("startFrom",function(){return function(e,t){return t=+t,e.slice(t)}}),function(){function e(n,t,e,a,r){var o=this;o.title="Comments",o.msg="Searching comments...",o.logedin=a.logedin(),o.user=a.currUser(),o.currentPage=0,o.currentPageCached=0,o.pageSize=10,o.q="",o.dataSize=0,o.data={},o.data.comments=[],o.data.count={},o.data.cached=[],o.data.cacheIndexprevExtraPage=0,o.data.cacheIndexprevPage=1,o.data.cacheIndexcurrPage=2,o.data.cacheIndexnextPage=3,o.cacheLimit=4,o.search=!1,o.numberOfPages=function(){return o.search?Math.ceil(o.getData().length/o.pageSize):o.data.count.pages},o.clientSide=o.numberOfPages()<=o.cacheLimit;var c=function(e){if(o.clientSide)o.currentPage=e;else{var t=0<e?1<e?4:3:2;o.data.comments="",o.currentPage=e,e=2<t?3<t?e-2:e-1:e,n.getCommentsPage({page:o.currentPage,pageSize:o.pageSize,pageNo:t}).then(function(e){o.msg=0<e.data.length?"":"No comments.",o.data.cached=e.data,t<=2&&o.data.cached.unshift(e.data[0]),t<=3&&o.data.cached.unshift(e.data[0]),o.data.comments=o.data.cached[o.data.cacheIndexcurrPage]},function(e){o.error=!0,o.msg="Error while fetching comments.",console.log(e.e)})}};o.newComment=function(){o.newcomment.pic="",o.newcomment.name=o.user.name,o.newcomment.username=o.user.mail,n.newComment(o.newcomment).then(function(e){o.msg=0<e.data.length?"":"No comments.",o.clientSide?o.data.comments.unshift(e.data):(o.data.cached.slice(-1)[0].unshift(o.data.cached[o.data.cacheIndexcurrPage].slice(-1)[0]),o.data.cached.slice(-1)[0].pop(),0==o.currentPage?(o.data.comments.unshift(e.data),o.data.comments.pop(),o.data.cached[o.data.cacheIndexcurrPage]=o.data.comments):(o.data.cached[o.data.cacheIndexcurrPage].unshift(o.data.cached[o.data.cacheIndexprevPage].slice(-1)[0]),o.data.cached[o.data.cacheIndexcurrPage].pop(),1==o.currentPage?(o.data.cached[o.data.cacheIndexprevPage].unshift(e.data),o.data.cached[o.data.cacheIndexprevPage].pop()):(o.data.cached[o.data.cacheIndexprevPage].unshift(o.data.cached[o.data.cacheIndexprevExtraPage].slice(-1)[0]),o.data.cached[o.data.cacheIndexprevPage].pop(),2==o.currentPage&&(o.data.cached[o.data.cacheIndexprevExtraPage].unshift(e.data),o.data.cached[o.data.cacheIndexprevExtraPage].pop()))),o.newcomment.name="",o.newcomment.comment="")},function(e){o.error=!0,o.msg="Error while fetching comments.",console.log(e.e)})},e.redirectTo=function(e){t.url("/comments/"+e._id)},n.getCommentsCount().then(function(e){o.data.count=e.data},function(e){o.error=!0,o.msg="Error while fetching comments count.",console.log(e.e)}),o.getData=function(){return r("filter")(o.data.comments,o.q)},o.getDataLenght=function(){return o.data.count.size};o.next=function(){o.currentPage=o.currentPage+1,o.clientSide||o.search||(o.data.comments=o.data.cached[o.data.cacheIndexnextPage],0<o.data.comments.length?(o.data.cached.shift(),o.data.cached.push([]),o.currentPage+1>=o.numberOfPages()?o.data.cached[o.data.cacheIndexnextPage]=o.data.cached[o.data.cacheIndexcurrPage]:n.getCommentsPage({page:o.currentPage+1,pageSize:o.pageSize}).then(function(e){o.data.cached[o.data.cacheIndexnextPage]=e.data[0]},function(e){o.error=!0,o.msg="Error while fetching comments."})):c(o.currentPage))},o.previous=function(){o.currentPage=o.currentPage-1,o.clientSide||o.search||(o.data.comments=o.data.cached[o.data.cacheIndexprevPage],0<o.data.comments.length?(o.data.cached.pop(),o.data.cached.unshift([]),o.currentPage-2<0?o.data.cached[o.data.cacheIndexprevExtraPage]=o.data.cached[o.data.cacheIndexprevPage]:n.getCommentsPage({page:o.currentPage-2,pageSize:o.pageSize}).then(function(e){o.data.cached[o.data.cacheIndexprevExtraPage]=e.data[0]},function(e){o.error=!0,o.msg="Error while fetching comments.",console.log(e.e)})):c(o.currentPage))},o.serverSearch=function(e){""!=e&&(o.msg="Server searches...",o.currentPageCached=o.currentPage,o.currentPage=0,n.commentByUsername(e).then(function(e){o.data.comments=e.data,o.search=!0,o.msg=""},function(e){o.error=!0,o.msg="Error while fetching comments.",console.log(e.e)}))},o.cancelSearch=function(){o.search&&(o.msg="Search is canceled. You can now add comment.",o.searchname="",o.search=!1,o.currentPage=o.currentPageCached,o.data.comments=o.data.cached[1])},e.redirectTo=function(e){t.url("/comments/"+e._id)},o.data.comments.length||c(o.currentPage)}e.$inject=["commentsData","$location","$scope","authentication","$filter"],angular.module("comments").controller("commentsCtrl",e)}(),function(){function e(e,t,n,a){var r=this;r.idComment=e.idComment,r.logedin=a.logedin(),r.canEdit=function(e){return!(!r.logedin||!e)&&a.getDataFromToken(a.returnToken())._id==e._creator},t.commentById(r.idComment).then(function(e){r.comment=e.data,r.general={title:r.comment.name}},function(e){console.log(e)}),r.editComm=function(e,t){n.open({templateUrl:"/comments/commentEdit/commentEdit.view.html",controller:"commentEdit",controllerAs:"vm",resolve:{commentDetails:function(){return{comment:t}}}}).result.then(function(e){void 0!==e&&(r.comment=e)},function(e){console.log("Error im comment View",e)})}}e.$inject=["$routeParams","commentsData","$uibModal","authentication"],angular.module("comments").controller("commentsViewCtrl",e)}(),function(){function e(t,e,n){var a=this;a.commentDetails=e,a.modalWindow={onclose:function(){t.close()},onsubmit:function(e){t.close(e)}},a.sendData=function(){return a.error="",a.editData.commentContent?(a.editComment(e.comment._id,a.editData.commentContent),!1):!(a.error="Input required!")},a.editComment=function(e,t){n.editCommentById(e,{comment:t}).then(function(e){a.modalWindow.onsubmit(e.data)},function(e){a.error="Error!"})}}e.$inject=["$uibModalInstance","commentDetails","commentsData"],angular.module("comments").controller("commentEdit",e)}(),function(){function e(e,n,t,a,r){var o=this;o.logedin=n.logedin(),o.landing="/"!=a.path(),o.user=n.currUser(),o.user&&(o.user.username=o.user.mail),o.canDelete=function(e){if(!o.logedin||!e)return!1;var t=n.getDataFromToken(n.returnToken());return t.admin||t._id==e._creator},o.deleteById=function(e){t.deleteById(e,o.user).then(function(e){a.path("/")},function(e){o.error="Error!"})}}e.$inject=["$scope","authentication","commentsData","$location","$route"],angular.module("comments").controller("commentDirCtrl",e)}(),function(){var e=function(e){return{restrict:"EA",scope:{commentdirective:"=onecomment",onclick:"&onclickf"},templateUrl:"/all/directives/comment/comment.view.html",controller:"commentDirCtrl",controllerAs:"commdirvm"}};e.$inject=["$uibModal"],angular.module("comments").directive("comment",e)}(),angular.module("comments").directive("footos",function(){return{restrict:"EA",templateUrl:"/all/directives/footer/footer.template.html"}}),function(){function e(e,t,n){this.currLocation=e.path(),this.logedin=t.logedin(),this.currUser=t.currUser(),this.logout=function(){t.logout(),e.path("/"),n.reload()}}e.$inject=["$location","authentication","$route"],angular.module("comments").controller("navigaCtrl",e)}(),angular.module("comments").directive("naviga",function(){return{restrict:"EA",templateUrl:"/all/directives/nav/nav.template.html",controller:"navigaCtrl",controllerAs:"navigavm"}});