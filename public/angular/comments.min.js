angular.module("comments",["ngRoute","ui.bootstrap","ngSanitize"]).config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{templateUrl:"comments/comments.view.html",controller:"commentsCtrl",controllerAs:"vm"}).when("/comments/:idComment",{templateUrl:"comments/commentViewing/commentView.view.html",controller:"commentsViewCtrl",controllerAs:"vm"}).when("/registration",{templateUrl:"/auth/registration/registration.view.html",controller:"registrationCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/404",{templateUrl:"error/404.template.html"}).otherwise({redirectTo:"/404"}),t.html5Mode(!0),t.hashPrefix("")}]),function(){function e(n,a){return{comments:function(){return n.get("/api/comments")},commentById:function(e){return n.get("/api/comments/"+e)},editCommentById:function(e,t){return n.post("/api/comments/edit/"+e,t,{headers:{Authorization:"Bearer "+a.returnToken()}})},deleteById:function(e){a.currUser();return n.delete("/api/comments/"+e,{headers:{Authorization:"Bearer "+a.returnToken()}})},newComment:function(e){return n.post("/api/comments/new",e,{headers:{Authorization:"Bearer "+a.returnToken()}})},getCommentsPage:function(e){return n.get("/api/comments",{params:e})},getCommentsCount:function(e){return n.get("/api/comments-count",{})},commentByUsername:function(e){return n.get("/api/search/comments",{params:{name:e}})}}}e.$inject=["$http","authentication"],angular.module("comments").service("commentsData",e)}(),function(){function e(t,n){var a=function(e){return decodeURIComponent(Array.prototype.map.call(t.atob(e),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))},o=function(e){t.localStorage["comments-token"]=e},r=function(){return t.localStorage["comments-token"]},c=function(){var e=r();return!!e&&JSON.parse(a(e.split(".")[1])).validityDate>Date.now()/1e3};return{storeToken:o,returnToken:r,registration:function(e){return console.log("auth",e),n.post("/api/registration",e).then(function(e){o(e.data.token)})},login:function(e){return n.post("/api/login",e).then(function(e){o(e.data.token)})},logout:function(){t.localStorage.removeItem("comments-token")},logedin:c,currUser:function(){if(c()){var e=r(),t=JSON.parse(a(e.split(".")[1]));return{mail:t.mail,name:t.name}}},isAdmin:function(){if(c()){var e=r();return JSON.parse(a(e.split(".")[1])).admin}},getDataFromToken:function(e){return JSON.parse(a(e.split(".")[1]))}}}e.$inject=["$window","$http"],angular.module("comments").service("authentication",e)}(),function(){function e(t,e){var n=this;n.loginData={mail:"",pass:""},n.firstToDisplay=t.search().page||"/",n.sendContent=function(){if(n.error="",!n.loginData.mail||!n.loginData.pass)return!(n.error="All data required.");n.login()},n.login=function(){n.error="",console.log(n.loginData),e.login(n.loginData).then(function(e){t.search("page",null),t.path(n.firstToDisplay)},function(e){n.error=e.data})}}e.$inject=["$location","authentication"],angular.module("comments").controller("loginCtrl",e)}(),function(){function e(t,e){var n=this;n.registerData={name:"",mail:"",pass:""},n.firstToDisplay=t.search().page||"/",n.sendContent=function(){if(n.error="",!(n.registerData.name&&n.registerData.mail&&n.registerData.pass))return!(n.error="Enter all the data!");n.register()},n.register=function(){n.error="",e.registration(n.registerData).then(function(e){t.search("login",null),t.path(n.firstToDisplay)},function(e){n.error=e.data})}}e.$inject=["$location","authentication"],angular.module("comments").controller("registrationCtrl",e)}(),angular.module("comments").filter("startFrom",function(){return function(e,t){return t=+t,e.slice(t)}}),function(){function e(n,t,e,a,o){var r=this;r.title="Comments",r.msg="Searching comments...",r.logedin=a.logedin(),r.user=a.currUser(),r.currentPage=0,r.currentPageCached=0,r.pageSize=10,r.q="",r.dataSize=0,r.data={},r.data.comments=[],r.data.count={},r.data.cached=[],r.data.cacheIndexprevExtraPage=0,r.data.cacheIndexprevPage=1,r.data.cacheIndexcurrPage=2,r.data.cacheIndexnextPage=3,r.cacheLimit=4,r.search=!1,r.numberOfPages=function(){return r.search?Math.ceil(r.getData().length/r.pageSize):r.data.count.pages},r.clientSide=r.numberOfPages()<=r.cacheLimit;r.newComment=function(){r.newcomment.pic="",r.newcomment.name=r.user.name,r.newcomment.username=r.user.mail,n.newComment(r.newcomment).then(function(e){r.msg=0<e.data.length?"":"No comments.",r.clientSide?r.data.comments.unshift(e.data):(r.data.cached.slice(-1)[0].unshift(r.data.cached[r.data.cacheIndexcurrPage].slice(-1)[0]),r.data.cached.slice(-1)[0].pop(),0==r.currentPage?(r.data.comments.unshift(e.data),r.data.comments.pop(),r.data.cached[r.data.cacheIndexcurrPage]=r.data.comments):(r.data.cached[r.data.cacheIndexcurrPage].unshift(r.data.cached[r.data.cacheIndexprevPage].slice(-1)[0]),r.data.cached[r.data.cacheIndexcurrPage].pop(),1==r.currentPage?(r.data.cached[r.data.cacheIndexprevPage].unshift(e.data),r.data.cached[r.data.cacheIndexprevPage].pop()):(r.data.cached[r.data.cacheIndexprevPage].unshift(r.data.cached[r.data.cacheIndexprevExtraPage].slice(-1)[0]),r.data.cached[r.data.cacheIndexprevPage].pop(),2==r.currentPage&&(r.data.cached[r.data.cacheIndexprevExtraPage].unshift(e.data),r.data.cached[r.data.cacheIndexprevExtraPage].pop()))),r.newcomment.name="",r.newcomment.comment="")},function(e){r.error=!0,r.msg="Error while fetching comments.",console.log(e.e)})},e.redirectTo=function(e){t.url("/comments/"+e._id)},n.getCommentsCount().then(function(e){r.data.count=e.data},function(e){r.error=!0,r.msg="Error while fetching comments count.",console.log(e.e)}),r.getData=function(){return o("filter")(r.data.comments,r.q)},r.getDataLenght=function(){return r.data.count.size};r.next=function(){r.currentPage=r.currentPage+1,r.clientSide||r.search||(r.data.comments=r.data.cached[r.data.cacheIndexnextPage],r.data.cached.shift(),r.data.cached.push([]),r.currentPage+1>=r.numberOfPages()?r.data.cached[r.data.cacheIndexnextPage]=r.data.cached[r.data.cacheIndexcurrPage]:n.getCommentsPage({page:r.currentPage+1,pageSize:r.pageSize}).then(function(e){r.data.cached[r.data.cacheIndexnextPage]=e.data[0]},function(e){r.error=!0,r.msg="Error while fetching comments.",console.log(e.e)}))},r.previous=function(){r.currentPage=r.currentPage-1,r.clientSide||r.search||(r.data.comments=r.data.cached[r.data.cacheIndexprevPage],r.data.cached.pop(),r.data.cached.unshift([]),r.currentPage-2<0?r.data.cached[r.data.cacheIndexprevExtraPage]=r.data.cached[r.data.cacheIndexprevPage]:n.getCommentsPage({page:r.currentPage-2,pageSize:r.pageSize}).then(function(e){r.data.cached[r.data.cacheIndexprevExtraPage]=e.data[0]},function(e){r.error=!0,r.msg="Error while fetching comments.",console.log(e.e)}))},r.serverSearch=function(e){""!=e&&(r.msg="Server searches...",r.currentPageCached=r.currentPage,r.currentPage=0,n.commentByUsername(e).then(function(e){r.data.comments=e.data,r.search=!0,r.msg=""},function(e){r.error=!0,r.msg="Error while fetching comments.",console.log(e.e)}))},r.cancelSearch=function(){r.msg="Server s. canceled.",r.searchname="",r.search=!1,r.currentPage=r.currentPageCached,r.data.comments=r.data.cached[1]},e.redirectTo=function(e){t.url("/comments/"+e._id)},r.data.comments.length||function(e){if(r.clientSide)r.currentPage=e;else{var t=0<e?1<e?4:3:2;r.data.comments="",r.currentPage=e,e=2<t?3<t?e-2:e-1:e,n.getCommentsPage({page:r.currentPage,pageSize:r.pageSize,pageNo:t}).then(function(e){r.msg=0<e.data.length?"":"No comments.",r.data.cached=e.data,t<=2&&r.data.cached.unshift(e.data[0]),t<=3&&r.data.cached.unshift(e.data[0]),r.data.comments=r.data.cached[r.data.cacheIndexcurrPage]},function(e){r.error=!0,r.msg="Error while fetching comments.",console.log(e.e)})}}(r.currentPage)}e.$inject=["commentsData","$location","$scope","authentication","$filter"],angular.module("comments").controller("commentsCtrl",e)}(),function(){function e(e,t,n,a){var o=this;o.idComment=e.idComment,o.logedin=a.logedin(),o.canEdit=function(e){return!(!o.logedin||!e)&&a.getDataFromToken(a.returnToken())._id==e._creator},t.commentById(o.idComment).then(function(e){o.comment=e.data,o.general={title:o.comment.name}},function(e){console.log(e)}),o.editComm=function(e,t){n.open({templateUrl:"/comments/commentEdit/commentEdit.view.html",controller:"commentEdit",controllerAs:"vm",resolve:{commentDetails:function(){return{comment:t}}}}).result.then(function(e){void 0!==e&&(o.comment=e)},function(e){console.log("Error im comment View",e)})}}e.$inject=["$routeParams","commentsData","$uibModal","authentication"],angular.module("comments").controller("commentsViewCtrl",e)}(),function(){function e(t,e,n){var a=this;a.commentDetails=e,a.modalWindow={onclose:function(){t.close()},onsubmit:function(e){t.close(e)}},a.sendData=function(){return a.error="",a.editData.commentContent?(a.editComment(e.comment._id,a.editData.commentContent),!1):!(a.error="Input required!")},a.editComment=function(e,t){n.editCommentById(e,{comment:t}).then(function(e){a.modalWindow.onsubmit(e.data)},function(e){a.error="Error!"})}}e.$inject=["$uibModalInstance","commentDetails","commentsData"],angular.module("comments").controller("commentEdit",e)}(),function(){function e(e,n,t,a,o){var r=this;r.logedin=n.logedin(),r.landing="/"!=a.path(),r.user=n.currUser(),r.user&&(r.user.username=r.user.mail),r.canDelete=function(e){if(!r.logedin||!e)return!1;var t=n.getDataFromToken(n.returnToken());return t.admin||t._id==e._creator},r.deleteById=function(e){t.deleteById(e,r.user).then(function(e){a.path("/")},function(e){r.error="Error!"})}}e.$inject=["$scope","authentication","commentsData","$location","$route"],angular.module("comments").controller("commentDirCtrl",e)}(),function(){var e=function(e){return{restrict:"EA",scope:{commentdirective:"=onecomment",onclick:"&onclickf"},templateUrl:"/all/directives/comment/comment.view.html",controller:"commentDirCtrl",controllerAs:"commdirvm"}};e.$inject=["$uibModal"],angular.module("comments").directive("comment",e)}(),angular.module("comments").directive("footos",function(){return{restrict:"EA",templateUrl:"/all/directives/footer/footer.template.html"}}),function(){function e(e,t,n){this.currLocation=e.path(),this.logedin=t.logedin(),this.currUser=t.currUser(),this.logout=function(){t.logout(),e.path("/"),n.reload()}}e.$inject=["$location","authentication","$route"],angular.module("comments").controller("navigaCtrl",e)}(),angular.module("comments").directive("naviga",function(){return{restrict:"EA",templateUrl:"/all/directives/nav/nav.template.html",controller:"navigaCtrl",controllerAs:"navigavm"}});