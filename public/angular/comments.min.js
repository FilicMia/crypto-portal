angular.module("comments",["ngRoute","ui.bootstrap","ngSanitize"]).config(["$routeProvider","$locationProvider",function(t,n){t.when("/",{templateUrl:"comments/comments.view.html",controller:"commentsCtrl",controllerAs:"vm"}).when("/comments/:idComment",{templateUrl:"comments/commentViewing/commentView.view.html",controller:"commentsViewCtrl",controllerAs:"vm"}).when("/registration",{templateUrl:"/auth/registration/registration.view.html",controller:"registrationCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/404",{templateUrl:"error/404.template.html"}).otherwise({redirectTo:"/404"}),n.html5Mode(!0),n.hashPrefix("")}]),function(){function t(e,o){return{comments:function(){return e.get("/api/comments")},commentById:function(t){return e.get("/api/comments/"+t)},editCommentById:function(t,n){return e.post("/api/comments/edit/"+t,n,{headers:{Authorization:"Bearer "+o.returnToken()}})},deleteById:function(t){o.currUser();return e.delete("/api/comments/"+t,{headers:{Authorization:"Bearer "+o.returnToken()}})},newComment:function(t){return e.post("/api/comments/new",t,{headers:{Authorization:"Bearer "+o.returnToken()}})},getCommentsPage:function(t){return e.get("/api/comments",{params:{page:t}})},getCommentsCount:function(t){return e.get("/api/comments-count",{})}}}t.$inject=["$http","authentication"],angular.module("comments").service("commentsData",t)}(),function(){function t(n,e){var o=function(t){return decodeURIComponent(Array.prototype.map.call(n.atob(t),function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""))},r=function(t){n.localStorage["comments-token"]=t},i=function(){return n.localStorage["comments-token"]},a=function(){var t=i();return!!t&&JSON.parse(o(t.split(".")[1])).validityDate>Date.now()/1e3};return{storeToken:r,returnToken:i,registration:function(t){return console.log("auth",t),e.post("/api/registration",t).then(function(t){r(t.data.token)})},login:function(t){return e.post("/api/login",t).then(function(t){r(t.data.token)})},logout:function(){n.localStorage.removeItem("comments-token")},logedin:a,currUser:function(){if(a()){var t=i(),n=JSON.parse(o(t.split(".")[1]));return{mail:n.mail,name:n.name}}},isAdmin:function(){if(a()){var t=i();return JSON.parse(o(t.split(".")[1])).admin}},getDataFromToken:function(t){return JSON.parse(o(t.split(".")[1]))}}}t.$inject=["$window","$http"],angular.module("comments").service("authentication",t)}(),function(){function t(n,t){var e=this;e.loginData={mail:"",pass:""},e.firstToDisplay=n.search().page||"/",e.sendContent=function(){if(e.error="",!e.loginData.mail||!e.loginData.pass)return!(e.error="All data required.");e.login()},e.login=function(){e.error="",console.log(e.loginData),t.login(e.loginData).then(function(t){n.search("page",null),n.path(e.firstToDisplay)},function(t){e.error=t.data})}}t.$inject=["$location","authentication"],angular.module("comments").controller("loginCtrl",t)}(),function(){function t(n,t){var e=this;e.registerData={name:"",mail:"",pass:""},e.firstToDisplay=n.search().page||"/",e.sendContent=function(){if(e.error="",!(e.registerData.name&&e.registerData.mail&&e.registerData.pass))return!(e.error="Enter all the data!");e.register()},e.register=function(){e.error="",t.registration(e.registerData).then(function(t){n.search("login",null),n.path(e.firstToDisplay)},function(t){e.error=t.data})}}t.$inject=["$location","authentication"],angular.module("comments").controller("registrationCtrl",t)}(),angular.module("comments").filter("startFrom",function(){return function(t,n){return n=+n,t.slice(n)}}),function(){function t(t,n,e,o,r){var i=this;i.title="Comments",i.msg="Searching comments...",i.logedin=o.logedin(),i.user=o.currUser(),t.comments().then(function(t){i.msg=0<t.data.length?"":"No comments.",i.data={comments:t.data}},function(t){i.msg="Error while fetching comments.",console.log(t.e)}),i.newComment=function(){i.newcomment.pic="",i.newcomment.name=i.user.name,i.newcomment.username=i.user.mail,t.newComment(i.newcomment).then(function(t){i.msg=0<t.data.length?"":"No comments.",i.data.comments.push(t.data),i.newcomment.name="",i.newcomment.comment="",console.log(i.data)},function(t){i.msg="Error while fetching comments.",console.log(t.e)})},e.redirectTo=function(t){n.url("/comments/"+t._id)},i.currentPage=0,i.pageSize=10,i.q="",i.dataSize=0,i.data={},i.data.comments=[],i.data.count={},t.getCommentsCount().then(function(t){i.data.count=t.data},function(t){i.msg="Error while fetching comments count.",console.log(t.e)}),i.getData=function(){return r("filter")(i.data.comments,i.q)},i.getDataLenght=function(){return i.data.count.size},i.numberOfPages=function(){return i.data.count.pages},e.redirectTo=function(t){n.url("/comments/"+t._id)}}t.$inject=["commentsData","$location","$scope","authentication","$filter"],angular.module("comments").controller("commentsCtrl",t)}(),function(){function t(t,n,e,o){var r=this;r.idComment=t.idComment,r.logedin=o.logedin(),r.canEdit=function(t){return!(!r.logedin||!t)&&o.getDataFromToken(o.returnToken())._id==t._creator},n.commentById(r.idComment).then(function(t){r.comment=t.data,r.general={title:r.comment.name}},function(t){console.log(t)}),r.editComm=function(t,n){e.open({templateUrl:"/comments/commentEdit/commentEdit.view.html",controller:"commentEdit",controllerAs:"vm",resolve:{commentDetails:function(){return{comment:n}}}}).result.then(function(t){void 0!==t&&(r.comment=t)},function(t){console.log("Error im comment View",t)})}}t.$inject=["$routeParams","commentsData","$uibModal","authentication"],angular.module("comments").controller("commentsViewCtrl",t)}(),function(){function t(n,t,e){var o=this;o.commentDetails=t,o.modalWindow={onclose:function(){n.close()},onsubmit:function(t){n.close(t)}},o.sendData=function(){return o.error="",o.editData.commentContent?(o.editComment(t.comment._id,o.editData.commentContent),!1):!(o.error="Input required!")},o.editComment=function(t,n){e.editCommentById(t,{comment:n}).then(function(t){o.modalWindow.onsubmit(t.data)},function(t){o.error="Error!"})}}t.$inject=["$uibModalInstance","commentDetails","commentsData"],angular.module("comments").controller("commentEdit",t)}(),function(){function t(t,e,n,o,r){var i=this;i.logedin=e.logedin(),i.landing="/"!=o.path(),i.user=e.currUser(),i.user&&(i.user.username=i.user.mail),i.canDelete=function(t){if(!i.logedin||!t)return!1;var n=e.getDataFromToken(e.returnToken());return n.admin||n._id==t._creator},i.deleteById=function(t){n.deleteById(t,i.user).then(function(t){o.path("/")},function(t){i.error="Error!"})}}t.$inject=["$scope","authentication","commentsData","$location","$route"],angular.module("comments").controller("commentDirCtrl",t)}(),function(){var t=function(t){return{restrict:"EA",scope:{commentdirective:"=onecomment",onclick:"&onclickf"},templateUrl:"/all/directives/comment/comment.view.html",controller:"commentDirCtrl",controllerAs:"commdirvm"}};t.$inject=["$uibModal"],angular.module("comments").directive("comment",t)}(),angular.module("comments").directive("footos",function(){return{restrict:"EA",templateUrl:"/all/directives/footer/footer.template.html"}}),function(){function t(t,n,e){this.currLocation=t.path(),this.logedin=n.logedin(),this.currUser=n.currUser(),this.logout=function(){n.logout(),t.path("/"),e.reload()}}t.$inject=["$location","authentication","$route"],angular.module("comments").controller("navigaCtrl",t)}(),angular.module("comments").directive("naviga",function(){return{restrict:"EA",templateUrl:"/all/directives/nav/nav.template.html",controller:"navigaCtrl",controllerAs:"navigavm"}});